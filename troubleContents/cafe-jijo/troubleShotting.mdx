---
title: Jijo Cafe í”„ë¡œì íŠ¸ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
category: cafe-jijo
---

# ğŸŠâ€â™‚ï¸ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

## 1. zustandë¥¼ í†µí•œ ë¡œê·¸ì¸/íšŒì›ê°€ì… ìƒíƒœ êµ¬í˜„

### ë¬¸ì œì 

- íšŒì›ê°€ì…ì´ë‚˜, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì€ PB SDKë¥¼ ì‚¬ìš©í•˜ì—¬ `useAuthStore`ì˜ ë©”ì„œë“œë¡œ êµ¬ì„±ì„ í–ˆì—ˆë‹¤
- ì—¬ê¸°ì„œ ìƒê°í•˜ê¸°ì— ìƒˆë¡œ ì—…ë°ì´íŠ¸ ë˜ê±°ë‚˜ / í˜¹ì€ ë°ì´í„° ë‚´ì— ìˆë˜ ê¸°ì¡´ ìœ ì €ì •ë³´ë¥¼ `store`ë‚´ ì—…ë°ì´íŠ¸ ëœ `initalAuthState`ì— ë‹´ì•„ì•¼í•˜ëŠ”ë° ê·¸ ë°©ë²•ì„ ì–´ë–»ê²Œ êµ¬í˜„í•´ì•¼ê¹Œ?

**í˜„ì¬ê¹Œì§€ êµ¬ì„±í•œ ì½”ë“œ**

```jsx
import pb from "@/api/pocketbase";
import {create} from "zustand";

const initalAuthState = {
  isAuth: false,
  user: null,
  token: "",
};

const useAuthStore = create((set) => ({
  ...initalAuthState,

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ íšŒì›ê°€ì… */
  signUp: async (registerUser) => {
    return await pb.collection("users").create(registerUser);
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ì¸ */
  signIn: async (userNameOrEmail, password) => {
    return await pb
      .collection("users")
      .authWithPassword(userNameOrEmail, password);
    // dbì— ìˆëŠ” ìœ íš¨í•œ ë¡œê·¸ì¸ ì •ë³´ì¼ì‹œ í•´ë‹¹ ì •ë³´ë¥¼ setì„ í†µí•´ ë‹´ì•„ì•¼ í•  ê²ƒê°™ì€ë° ì–´ë–»ê²Œ ë‹´ì•„ì•¼í• ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤ğŸ¥¹
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ì•„ì›ƒ */
  signOut: async () => {
    return await pb.authStore.clear();
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ íšŒì›íƒˆí‡´ */
  Withdrawal: async (recordId) => {
    return await pb.collection("users").delete(recordId);
  },
}));

export default useAuthStore;
```

### í•´ê²° : ì‘ë‹µë°›ì€ ê²°ê³¼ë¥¼ ë°”ë¡œ ë‚´ë³´ë‚´ì§€ ì•Šê³ , Zustandì˜ set() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì•± ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ì!

`**store/auth.js**`

```tsx
import pb from "@/api/pocketbase";
import {create} from "zustand";
import {devtools} from "zustand/middleware";

const USER_COLLECTION = "users";

const initialAuthState = {
  isAuth: false,
  user: null,
  token: "",
};

const authStore = (set) => ({
  ...initialAuthState,

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ íšŒì›ê°€ì… */
  signUp: async (registerUser) => {
    return await pb.collection(USER_COLLECTION).create(registerUser);
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ì¸ */
  signIn: async (userNameOrEmail, password) => {
    const authData = await pb
      .collection(USER_COLLECTION)
      .authWithPassword(userNameOrEmail, password);

    const {isValid, model, token} = pb.authStore;

    set(
      (state) => ({
        ...state,
        isAuth: isValid,
        user: model,
        token,
      }),
      false,
      "auth/singin"
    );

    return authData;
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ì•„ì›ƒ */
  signOut: async () => {
    const response = await pb.authStore.clear();

    set(
      (state) => ({
        ...state,
        ...initialAuthState,
      }),
      false,
      "auth/singout"
    );

    return response;
  },

  /* Pb SDKë¥¼ ì‚¬ìš©í•œ íšŒì›íƒˆí‡´ */
  withDrawal: async (recordId) => {
    const response = await pb.collection(USER_COLLECTION).delete(recordId);

    set(
      (state) => ({
        ...state,
        ...initialAuthState,
      }),
      false,
      "auth/withDrawal"
    );

    return response;
  },
});

const useAuthStore = create(devtools(authStore));

export default useAuthStore;
```

ë¡œê·¸ì¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ì€??

```tsx
import useAuthStore from '@/store/auth';
// ...

function SignIn() {
  const isAuth = useAuthStore((state) => state.isAuth);
  const signIn = useAuthStore((state) => state.signIn);

  const [formState, setFormState] = useState({
    email: '',
    password: '',
  });

  const handleSignIn = async (e) => {
    e.preventDefault();

    const { email, password } = formState;

    try {
      await signIn(email, password);
			// ...
    } catch (error) {
      console.error(error);
    }
  };

	// ...

  return (...);
}
```

<br />

<hr />

<br />

## 2. Zusatnd AuthStore ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„ (feat : ìŠ¤ëƒ…ìƒ· ê°™ì€ ìƒíƒœ)

### ë¬¸ì œì 

**`PocketBase`ë¡œ `Zusatnd AuthStore`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„ ì¤‘ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë‹¤ê°€ ë‘ê°€ì§€ì˜ ë¬¸ì œì ì´ ë°œìƒí–ˆë‹¤**

1. ì²«ë²ˆì§¸ ë¬¸ì œì 

- `SignInModal` ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¡œê·¸ì¸ ì‹œë„ ì‹œ â¡ï¸ ì²˜ìŒ í´ë¦­ ì‹œì—ëŠ” `toast.error`ì»´í¬ë„ŒíŠ¸ê°€ ìƒì„±ë˜ê³  / ë‹¤ìŒ ë‘ë²ˆì§¸ í´ë¦­ì‹œì—ëŠ” ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë˜ì—ˆë‹¤.
  - ì´ëŸ° ì´ìœ ê°€ ì™œì¼ê¹Œí•˜ê³  ì½˜ì†”ì°½ìœ¼ë¡œ í™•ì¸ì„ ë´¤ëŠ”ë°, ì½˜ì†”ì°½ì— ëœ¬ ë¬¸ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ, `useAuthStore`ì—ì„œ ê°€ì ¸ì˜¨ `user`ì˜ `userName`ì„ ì²«ë²ˆì§¸ í´ë¦­ ì‹œ ì½ì–´ì˜¤ì§€ ëª»í•œë‹¤ëŠ”ê²Œ ë¬¸ì œì¸ê²ƒê°™ë‹¤.
  - ë”°ë¼ì„œ, ë¡œê·¸ì¸ ì‹œ `AuthStore`ì—ì„œ `user.username`ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”, `AuthStore`ì˜ `State`ëŠ” ë¹„ë™ê¸° ì—…ë°ì´íŠ¸ë˜ê¸° ë•Œë¬¸ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

![TypeError](/assets/troublePosts/cafe-jijo/image1.png) _íƒ€ì…ì—ëŸ¬ ë°œìƒ_

2. ë‘ë²ˆì§¸ ë¬¸ì œì 

- ìœ„ì˜ ì²«ë²ˆì§¸ ë¬¸ì œì ê³¼ ë¹„ìŠ·í•œ ë§¥ë½ì¸ë°, `SignUp` ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ì—ì„œ ìœ ì €ê°€ íšŒì›ê°€ì…ì´ ë˜ë©´ -> í•´ë‹¹ í¼ì— ì…ë ¥í•œ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°”ë¡œ ë¡œê·¸ì¸ í›„ â¡ï¸ í™ˆí™”ë©´ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë¡œì§ìœ¼ë¡œ êµ¬ì„±í–ˆì—ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ê°€ì… í›„ í™ˆ í™”ë©´ ê¹Œì§„ ì´ë™ì´ ë˜ë‚˜, `handleSignIn` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `signIn(email,password)` ë¶€ë¶„ì´ ë°”ë¡œ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šì•„ `Failded to Authenticate Error`ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆë‹¤.

![Error](/assets/troublePosts/cafe-jijo/image2.png) _Failed to authenticate Error_

### í•´ê²°í–ˆë˜ ë°©ë²•ì€?

**user ìƒíƒœëŠ” ["ìŠ¤ëƒ…ìƒ·ê³¼ ê°™ì€ ìƒíƒœâ€](https://ko.react.dev/learn/state-as-a-snapshot)ì´ë¯€ë¡œ ë°œìƒí•œ ë¬¸ì œ**

- ë Œë”ë§ì€ `Reactê°€` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤ëŠ”ê²ƒì„ ì˜ë¯¸í•œë‹¤
- ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°˜í™˜ë˜ëŠ” `JSX`ëŠ” "ì‹œê°„ì— ë”°ë¥¸ UI ìŠ¤ëƒ…ìƒ·"ê³¼ ê°™ë‹¤
- ì»´í¬ë„ŒíŠ¸ì˜ `Props`, ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬, ì§€ì—­ë³€ìˆ˜ëŠ” ëª¨ë‘ ë Œë”ë§ ë‹¹ì‹œì˜ ìƒíƒœë¥¼ ì‚¬ìš©í•´ ê³„ì‚°ë˜ì—ˆë‹¤.

**`Zustand` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ Reactì˜ `useState` í›…ì„ ì‚¬ìš©í•œë‹¤**

- ê·¸ëŸ¬ë¯€ë¡œ ì‘ë™ ë°©ì‹ì„ ë™ì¼
- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤í–‰ë˜ëŠ” `handleSignIn` í•¨ìˆ˜ì˜ ì²˜ë¦¬ ì‹œì ì—ì„œ `user` ìƒíƒœëŠ” ìŠ¤ëƒ…ìƒ·(snapshot)ì…ë‹ˆë‹¤.
- ê·¸ëŸ¬ë¯€ë¡œ `signIn` í•¨ìˆ˜ì— ì˜í•´ ì¸ì¦ë˜ì—ˆë‹¤ í•˜ë”ë¼ë„ `user` ìƒíƒœëŠ” ë‹¤ìŒ ë²ˆ ë Œë”ë§ ê³¼ì •ì—ì„œ ì—…ë°ì´íŠ¸ ëœë‹¤.
  - ì¦‰, ë°”ë¡œ ê°’ì´ ë³€ê²½ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.
- ê·¸ëŸ¬ë¯€ë¡œ `user` ìƒíƒœ ë³€ê²½ì´ ê°ì§€ë  ë•Œ í† ìŠ¤íŠ¸ë¥¼ í™”ë©´ì— ë„ìš´ í›„ í™ˆ í˜ì´ì§€ë¡œ ì´ë™ì‹œì¼œì•¼ í•œë‹¤.

```jsx
src / components / SignInModal.jsx;

const user = useAuthStore((state) => state.user);

useEffect(() => {
  // ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ê°€ í™•ì¸ë˜ë©´
  if (user) {
    // íšŒì›ê°€ì… ì•ˆë‚´ í† ìŠ¤íŠ¸ í‘œì‹œ
    toast.success(`${user.username}ë‹˜ í™˜ì˜í•´ìš”ğŸ˜`, {icon: "ğŸ‘‹"});
    // í™ˆí˜ì´ì§€ë¡œ ì´ë™
    navigate("/");
    setIsClickedSignin(false);
  }
}, [user]);

const handleSignIn = async (e) => {
  try {
    e.preventDefault();
    const {email, password} = formData;
    // ë¡œê·¸ì¸ ì‹œë„
    await signIn(email, password);
  } catch (error) {
    toast.error(
      "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”",
      {icon: "ğŸ˜¥"}
    );
    throw new Error(error);
  }
};
```

<br />

<img width="80%" src="/assets/troublePosts/cafe-jijo/1.gif" />
*ì •ìƒì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ì´ë£¨ì–´ì§€ê³  ìˆëŠ” ëª¨ìŠµ!*
